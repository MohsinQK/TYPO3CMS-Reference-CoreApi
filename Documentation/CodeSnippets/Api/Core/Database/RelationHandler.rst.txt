.. Generated by https://github.com/linawolf/t3docs_restructured_api_tools 
.. php:namespace::  TYPO3\CMS\Core\Database

.. php:class:: RelationHandler

   Load database groups (relations)
   Used to process the relations created by the TCA element types "group" and "select" for database records.
   
   Manages MM-relations as well.
   
   See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php>`__.

   .. php:attr:: registerNonTableValues
   
      If set, values that are not ids in tables are normally discarded. By this options they will be preserved.
      
      
   .. php:attr:: tableArray
   
      Contains the table names as keys. The values are the id-values for each table.
      
      Should ONLY contain proper table names.
      
      
   .. php:attr:: itemArray
   
      Contains items in a numeric array (table/id for each). Tablenames here might be "_NO_TABLE". Keeps
      the sorting of thee retrieved items.
      
      
   .. php:attr:: nonTableArray
   
      Array for NON-table elements
      
      
   .. php:attr:: additionalWhere
   
      
   .. php:attr:: checkIfDeleted
   
      Deleted-column is added to additionalWhere... if this is set.
      
      ..
      
      
   .. php:attr:: undeleteRecord
   
      If a record should be undeleted
      (so do not use the $useDeleteClause on \TYPO3\CMS\Backend\Utility\BackendUtility)
      
      
   .. php:attr:: results
   
      This array will be filled by getFromDB().
      
      
   .. php:method:: setWorkspaceId()
   
      Sets the current workspace id.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L209>`__.
      
      
   .. php:method:: isPurged()
   
      Whether item array has been purged in this instance.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L230>`__.
      
      
   .. php:method:: start(string $itemlist, string $tablelist, string $MMtable, int|string $MMuid, string $currentTable, array $conf)
   
      Initialization of the class.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L245>`__.
      
      :param string $itemlist: List of group/select items
      :param string $tablelist: Comma list of tables, first table takes priority if no table is set for an entry in the list.
      :param string $MMtable: Name of a MM table.
      :param int|string $MMuid: Local UID for MM lookup. May be a string for newly created elements.
      :param string $currentTable: Current table name
      :param array $conf: TCA configuration for current field
      
   .. php:method:: setFetchAllFields(bool $allFields)
   
      Sets $fetchAllFields
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L334>`__.
      
      :param bool $allFields: enables fetching of all fields in getFromDB()
      
   .. php:method:: setUseLiveParentIds()
   
      
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L342>`__.
      
      
   .. php:method:: setUseLiveReferenceIds()
   
      
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L350>`__.
      
      
   .. php:method:: writeMM(string $MM_tableName, int $uid, bool $prependTableName)
   
      Writes the internal itemArray to MM table:
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L586>`__.
      
      :param string $MM_tableName: MM table name
      :param int $uid: Local UID
      :param bool $prependTableName: If set, then table names will always be written.
      
   .. php:method:: writeForeignField(array $conf, int $parentUid, int $updateToUid)
   
      Write the sorting values to a foreign_table, that has a foreign_field (uid of the parent record)
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L963>`__.
      
      :param array $conf: TCA configuration for current field
      :param int $parentUid: The uid of the parent record
      :param int $updateToUid: If this is larger than zero it will be used as foreign UID instead of the given $parentUid (on Copy)
      
   .. php:method:: getValueArray(bool $prependTableName)
   
      After initialization you can extract an array of the elements from the object. Use this function for that.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L1092>`__.
      
      :param bool $prependTableName: If set, then table names will ALWAYS be prepended (unless its a _NO_TABLE value)
      
   .. php:method:: getFromDB()
   
      Reads all records from internal tableArray into the internal ->results array
      where keys are table names and for each table, records are stored with uids as their keys.
      
      If $this->fetchAllFields is false you can save a little memory
      since only uid,pid and a few other fields are selected.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L1118>`__.
      
      
   .. php:method:: getResolvedItemArray()
   
      This method is typically called after getFromDB().
      
      $this->results holds a list of resolved and valid relations,
      $this->itemArray hold a list of "selected" relations from the incoming selection array.
      The difference is that "itemArray" may hold a single table/uid combination multiple times,
      for instance in a type=group relation having multiple=true, while "results" hold each
      resolved relation only once.
      The methods creates a sanitized "itemArray" from resolved "results" list, normalized
      the return array to always contain both table name and uid, and keep incoming
      "itemArray" sort order and keeps "multiple" selections.
      
      In addition, the item array contains the full record to be used later-on and save database queries.
      This method keeps the ordering intact.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L1166>`__.
      
      :returntype: array
      
   .. php:method:: countItems(bool $returnAsArray)
   
      Counts the items in $this->itemArray and puts this value in an array by default.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L1187>`__.
      
      :param bool $returnAsArray: Whether to put the count value in an array
      
   .. php:method:: convertItemArray()
   
      Converts elements in the local item array to use version ids instead of
      live ids, if possible. The most common use case is, to call that prior
      to processing with MM relations in a workspace context. For tha special
      case, ids on both side of the MM relation must use version ids if
      available.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L1223>`__.
      
      
   .. php:method:: processDeletePlaceholder()
   
      Removes items having a delete placeholder from $this->itemArray
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/Database/RelationHandler.php#L1303>`__.
