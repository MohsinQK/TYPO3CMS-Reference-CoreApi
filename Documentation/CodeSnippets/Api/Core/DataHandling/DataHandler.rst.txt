.. Generated by https://github.com/linawolf/t3docs_restructured_api_tools 
.. php:namespace::  TYPO3\CMS\Core\DataHandling

.. php:class:: DataHandler

   The main data handler class which takes care of correctly updating and inserting records.
   
   This class was formerly known as TCEmain.
   
   This is the TYPO3 Core Engine class for manipulation of the database
   This class is used by eg. the tce_db BE route (SimpleDataHandlerController) which provides an interface for POST forms to this class.
   
   Dependencies:
   - $GLOBALS['TCA'] must exist
   - $GLOBALS['LANG'] must exist
   
   Also see document 'TYPO3 Core API' for details.
   
   See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/DataHandling/DataHandler.php>`__.

   .. php:attr:: storeLogMessages
   
      If TRUE, the default log-messages will be stored. This should not be necessary if the locallang-file for the
      log-display is properly configured. So disabling this will just save some database-space as the default messages are not saved.
      
      
   .. php:attr:: enableLogging
   
      If TRUE, actions are logged to sys_log.
      
      
   .. php:attr:: reverseOrder
   
      If TRUE, the datamap array is reversed in the order, which is a nice thing if you're creating a whole new
      bunch of records.
      
      
   .. php:attr:: checkSimilar
   
      If TRUE, only fields which are different from the database values are saved! In fact, if a whole input array
      is similar, it's not saved then.
      
      
   .. php:attr:: checkStoredRecords
   
      This will read the record after having updated or inserted it. If anything is not properly submitted an error
      is written to the log. This feature consumes extra time by selecting records
      
      
   .. php:attr:: checkStoredRecords_loose
   
      If set, values '' and 0 will equal each other when the stored records are checked.
      
      
   .. php:attr:: neverHideAtCopy
   
      If set, then the 'hideAtCopy' flag for tables will be ignored.
      
      
   .. php:attr:: isImporting
   
      If set, then the TCE class has been instantiated during an import action of a T3D
      
      
   .. php:attr:: dontProcessTransformations
   
      If set, then transformations are NOT performed on the input.
      
      
   .. php:attr:: bypassWorkspaceRestrictions
   
      If TRUE, workspace restrictions are bypassed on edit and create actions (process_datamap()).
      
      YOU MUST KNOW what you do if you use this feature!
      
      
   .. php:attr:: bypassAccessCheckForRecords
   
      If TRUE, access check, check for deleted etc. for records is bypassed.
      
      YOU MUST KNOW what you are doing if you use this feature!
      
      
   .. php:attr:: copyWhichTables
   
      Comma-separated list. This list of tables decides which tables will be copied. If empty then none will.
      
      If '*' then all will (that the user has permission to of course)
      
      
   .. php:attr:: copyTree
   
      If 0 then branch is NOT copied.
      
      If 1 then pages on the 1st level is copied.
      If 2 then pages on the second level is copied ... and so on
      
      
   .. php:attr:: defaultValues
   
      [table][fields]=value: New records are created with default values and you can set this array on the
      form $defaultValues[$table][$field] = $value to override the default values fetched from TCA.
      
      If ->setDefaultsFromUserTS is called UserTSconfig default values will overrule existing values in this array
      (thus UserTSconfig overrules externally set defaults which overrules TCA defaults)
      
      
   .. php:attr:: overrideValues
   
      [table][fields]=value: You can set this array on the form $overrideValues[$table][$field] = $value to
      override the incoming data. You must set this externally. You must make sure the fields in this array are also
      found in the table, because it's not checked. All columns can be set by this array!
      
      
   .. php:attr:: data_disableFields
   
      If entries are set in this array corresponding to fields for update, they are ignored and thus NOT updated.
      
      You could set this array from a series of checkboxes with value=0 and hidden fields before the checkbox with 1.
      Then an empty checkbox will disable the field.
      
      
   .. php:attr:: suggestedInsertUids
   
      Use this array to validate suggested uids for tables by setting [table]:[uid]. This is a dangerous option
      since it will force the inserted record to have a certain UID. The value just have to be TRUE, but if you set
      it to "DELETE" it will make sure any record with that UID will be deleted first (raw delete).
      
      The option is used for import of T3D files when synchronizing between two mirrored servers.
      As a security measure this feature is available only for Admin Users (for now)
      
      
   .. php:attr:: callBackObj
   
      Object. Call back object for FlexForm traversal. Useful when external classes wants to use the
      iteration functions inside DataHandler for traversing a FlexForm structure.
      
      
   .. php:attr:: autoVersionIdMap
   
      Contains mapping of auto-versionized records.
      
      
   .. php:attr:: substNEWwithIDs
   
      When new elements are created, this array contains a map between their "NEW..." string IDs and the eventual UID they got when stored in database
      
      
   .. php:attr:: substNEWwithIDs_table
   
      Like $substNEWwithIDs, but where each old "NEW..." id is mapped to the table it was from.
      
      
   .. php:attr:: newRelatedIDs
   
      Holds the tables and there the ids of newly created child records from IRRE
      
      
   .. php:attr:: copyMappingArray_merged
   
      This array is the sum of all copying operations in this class.
      
      
   .. php:attr:: errorLog
   
      Errors are collected in this variable.
      
      
   .. php:attr:: pagetreeRefreshFieldsFromPages
   
      Fields from the pages-table for which changes will trigger a pagetree refresh
      
      
   .. php:attr:: pagetreeNeedsRefresh
   
      Indicates whether the pagetree needs a refresh because of important changes
      
      
   .. php:attr:: BE_USER
   
      The user-object the script uses. If not set from outside, this is set to the current global $BE_USER.
      
      
   .. php:attr:: userid
   
      Will be set to uid of be_user executing this script
      
      
   .. php:attr:: admin
   
      Will be set if user is admin
      
      
   .. php:attr:: datamap
   
      Set with incoming data array
      
      
   .. php:attr:: cmdmap
   
      Set with incoming cmd array
      
      
   .. php:attr:: sortIntervals
   
      The interval between sorting numbers used with tables with a 'sorting' field defined.
      
      Min 1, should be power of 2
      
      
   .. php:attr:: dbAnalysisStore
   
      For accumulation of MM relations that must be written after new records are created.
      
      
   .. php:attr:: registerDBList
   
      Used for tracking references that might need correction after operations
      
      
   .. php:attr:: registerDBPids
   
      Used for tracking references that might need correction in pid field after operations (e.g. IRRE)
      
      
   .. php:attr:: copyMappingArray
   
      Used by the copy action to track the ids of new pages so subpages are correctly inserted!
      THIS is internally cleared for each executed copy operation! DO NOT USE THIS FROM OUTSIDE!
      Read from copyMappingArray_merged instead which is accumulating this information.
      
      NOTE: This is used by some outside scripts (e.g. hooks), as the results in $copyMappingArray_merged
      are only available after an action has been completed.
      
      
   .. php:attr:: remapStack
   
      Array used for remapping uids and values at the end of process_datamap
      
      
   .. php:attr:: remapStackRecords
   
      Array used for remapping uids and values at the end of process_datamap
      (e.g. $remapStackRecords[<table>][<uid>] = <index in $remapStack>)
      
      
   .. php:attr:: checkValue_currentRecord
   
      Set to "currentRecord" during checking of values.
      
      
   .. php:method:: start(array $data, array $cmd, \BackendUserAuthentication|null $altUserObject)
   
      Initializing.
      
      For details, see 'TYPO3 Core API' document.
      This function does not start the processing of data, but merely initializes the object
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/DataHandling/DataHandler.php#L630>`__.
      
      :param array $data: Data to be modified or inserted in the database
      :param array $cmd: Commands to copy, move, delete, localize, versionize records.
      :param \BackendUserAuthentication|null $altUserObject: An alternative userobject you can set instead of the default, which is $GLOBALS['BE_USER']
      
   .. php:method:: process_datamap()
   
      Processing the data-array
      Call this function to process the data-array set by start()
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/DataHandling/DataHandler.php#L819>`__.
      
      
   .. php:method:: process_cmdmap()
   
      Processing the cmd-array
      See "TYPO3 Core API" for a description of the options.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/DataHandling/DataHandler.php#L3238>`__.
      
      
   .. php:method:: disableDeleteClause()
   
      Disables the delete clause for fetching records.
      
      In general only undeleted records will be used. If the delete
      clause is disabled, also deleted records are taken into account.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/DataHandling/DataHandler.php#L8288>`__.
      
      
   .. php:method:: clear_cacheCmd(int|string $cacheCmd)
   
      Clears the cache based on the command $cacheCmd.
      
      $cacheCmd='pages'
      Clears cache for all pages and page-based caches inside the cache manager.
      Requires admin-flag to be set for BE_USER.
      
      $cacheCmd='all'
      Clears all cache_tables. This is necessary if templates are updated.
      Requires admin-flag to be set for BE_USER.
      
      The following cache_* are intentionally not cleared by 'all'
      
      - imagesizes:	Clearing this table would cause a lot of unneeded
      Imagemagick calls because the size information has
      to be fetched again after clearing.
      - all caches inside the cache manager that are inside the group "system"
      - they are only needed to build up the core system and templates.
        If the group of system caches needs to be deleted explicitly, use
        flushCachesInGroup('system') of CacheManager directly.
      
      $cacheCmd=[integer]
      Clears cache for the page pointed to by $cacheCmd (an integer).
      
      $cacheCmd='cacheTag:[string]'
      Flush page and pagesection cache by given tag
      
      $cacheCmd='cacheId:[string]'
      Removes cache identifier from page and page section cache
      
      Can call a list of post processing functions as defined in
      $GLOBALS['TYPO3_CONF_VARS']['SC_OPTIONS']['t3lib/class.t3lib_tcemain.php']['clearCachePostProc']
      (numeric array with values being the function references, called by
      GeneralUtility::callUserFunction()).
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/DataHandling/DataHandler.php#L9076>`__.
      
      :param int|string $cacheCmd: The cache command, see above description
      
   .. php:method:: isOuterMostInstance()
   
      Determines whether the this object is the outer most instance of itself
      Since DataHandler can create nested objects of itself,
      this method helps to determine the first (= outer most) one.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/DataHandling/DataHandler.php#L9509>`__.
      
      
   .. php:method:: setCorrelationId()
   
      
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/DataHandling/DataHandler.php#L9680>`__.
      
      
   .. php:method:: getCorrelationId()
   
      
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/DataHandling/DataHandler.php#L9688>`__.
      
      :returntype: TYPO3\\CMS\\Core\\DataHandling\\Model\\CorrelationId
      
   .. php:method:: setLogger()
   
      Sets a logger.
      
      See source code on `GitHub <https://github.com/TYPO3/typo3/blob/main/typo3/sysext/core/Classes/DataHandling/DataHandler.php#L21>`__.
